<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube å½±éŸ¿åŠ›æ•¸æ“šåˆ†æå·¥å…· - VGV åœˆç²‰è¡ŒéŠ·ç§‘æŠ€</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #666; font-size: 1.1em; }

        .api-setup {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .api-setup h2 { color: #333; margin-bottom: 15px; }

        .api-setup input {
            width: 70%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            margin-right: 10px;
        }

        .api-setup button {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .api-setup button:hover { background: #5a6fd8; transform: translateY(-2px); }

        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }

        .section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5em;
        }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }

        .tab {
            padding: 8px 16px;
            border: none;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active { background: #667eea; color: white; }

        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ranking-item:hover {
            background: #e8ebff;
            transform: translateX(5px);
        }

        .rank-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-right: 15px;
            min-width: 50px;
        }

        .channel-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .channel-info h3 { color: #333; margin-bottom: 5px; }
        .channel-info p { color: #666; font-size: 0.9em; }

        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }

        .search-box input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-box button {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-box button:hover { background: #5a6fd8; }

        .channel-detail {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .channel-detail.active { display: block; }

        .channel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .channel-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-right: 20px;
        }

        .channel-header-info h3 { font-size: 1.5em; color: #333; margin-bottom: 5px; }
        .channel-header-info p { color: #666; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label { color: #666; font-size: 0.9em; margin-bottom: 5px; }
        .stat-value { color: #667eea; font-size: 1.5em; font-weight: bold; }

        .growth-positive { color: #4caf50; }
        .growth-negative { color: #f44336; }

        .loading { text-align: center; padding: 20px; color: #667eea; }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .api-setup input { width: 100%; margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ YouTube å½±éŸ¿åŠ›æ•¸æ“šåˆ†æå·¥å…·</h1>
            <p>VGV åœˆç²‰è¡ŒéŠ·ç§‘æŠ€ - å°ˆæ³¨å½±éŸ¿åŠ›è¡ŒéŠ·</p>
        </div>

        <div class="api-setup">
            <h2>ğŸ”‘ YouTube API è¨­å®š</h2>
            <input type="text" id="apiKeyInput" placeholder="è«‹è¼¸å…¥ä½ çš„ YouTube Data API Key">
            <button onclick="setApiKey()">è¨­å®š API Key</button>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                â„¹ï¸ å¦‚ä½•å–å¾— API Key: å‰å¾€ <a href="https://console.cloud.google.com/" target="_blank" style="color: #667eea;">Google Cloud Console</a> â†’
                å»ºç«‹å°ˆæ¡ˆ â†’ å•Ÿç”¨ YouTube Data API v3 â†’ å»ºç«‹æ†‘è­‰
            </p>
            <p style="margin-top: 8px; color: #666; font-size: 0.9em;">
                âœ… æœ¬å·¥å…·æœƒæŠŠä½ è¼¸å…¥çš„ Key å­˜åœ¨æœ¬æ©Ÿç€è¦½å™¨ï¼ˆlocalStorageï¼‰ï¼Œé¿å…æ¯æ¬¡é‡æ‰“ï¼›ä¸æœƒä¸Šå‚³åˆ°ä¼ºæœå™¨ã€‚
            </p>
        </div>

        <div class="main-content">
            <div class="section">
                <h2>ğŸ“Š YouTube å½±éŸ¿åŠ›æ’è¡Œæ¦œ</h2>
                <div class="tabs">
                    <button class="tab active" onclick="changeTimePeriod('30')">30å¤©</button>
                    <button class="tab" onclick="changeTimePeriod('90')">90å¤©</button>
                    <button class="tab" onclick="changeTimePeriod('180')">180å¤©</button>
                </div>

                <select id="countrySelect" onchange="loadRankings()">
                    <option value="TW">å°ç£ ğŸ‡¹ğŸ‡¼</option>
                    <option value="HK">é¦™æ¸¯ ğŸ‡­ğŸ‡°</option>
                    <option value="JP">æ—¥æœ¬ ğŸ‡¯ğŸ‡µ</option>
                    <option value="KR">éŸ“åœ‹ ğŸ‡°ğŸ‡·</option>
                    <option value="US">ç¾åœ‹ ğŸ‡ºğŸ‡¸</option>
                    <option value="GB">è‹±åœ‹ ğŸ‡¬ğŸ‡§</option>
                    <option value="SG">æ–°åŠ å¡ ğŸ‡¸ğŸ‡¬</option>
                    <option value="MY">é¦¬ä¾†è¥¿äº ğŸ‡²ğŸ‡¾</option>
                </select>

                <div id="rankingsList"></div>
            </div>

            <div class="section">
                <h2>ğŸ¯ é »é“æ•¸æ“šåˆ†æ</h2>
                <div class="search-box">
                    <input type="text" id="channelInput" placeholder="è¼¸å…¥é »é“åç¨±æˆ– ID">
                    <button onclick="searchChannel()">æœå°‹</button>
                </div>

                <div id="channelDetail" class="channel-detail"></div>
            </div>
        </div>
    </div>

    <script>
        // âš ï¸ å®‰å…¨æé†’ï¼šä¸è¦æŠŠçœŸå¯¦ API Key å¯«æ­»åœ¨å‰ç«¯ä¸¦ä¸Šå‚³åˆ° GitHubï¼ˆæœƒå…¬é–‹ï¼‰ã€‚
        // ä½ å¯ä»¥åœ¨ä¸‹æ–¹ API_KEY_DEFAULT æ”¾æ¸¬è©¦ç”¨ keyï¼ˆåƒ…é™ç§äººç’°å¢ƒï¼‰ï¼Œæ­£å¼ä¸Šç·šè«‹æ”¹ç”¨è¼¸å…¥æ¡†æˆ–å¾Œç«¯ä»£ç†ã€‚
        const API_KEY_DEFAULT = '';
        let API_KEY = localStorage.getItem('YOUTUBE_API_KEY') || API_KEY_DEFAULT;

        let currentTimePeriod = '30';
        let channelCache = {};

        function setApiKey() {
            const input = document.getElementById('apiKeyInput');
            API_KEY = (input.value || '').trim();
            if (API_KEY) {
                localStorage.setItem('YOUTUBE_API_KEY', API_KEY);
                alert('âœ… API Key è¨­å®šæˆåŠŸï¼ˆå·²å„²å­˜åœ¨æœ¬æ©Ÿç€è¦½å™¨ï¼‰ï¼');
                loadRankings();
            } else {
                alert('âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„ API Key');
            }
        }

        function changeTimePeriod(period) {
            currentTimePeriod = period;
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            loadRankings();
        }

        async function loadRankings() {
            if (!API_KEY) {
                document.getElementById('rankingsList').innerHTML =
                    '<div class="error">âš ï¸ è«‹å…ˆè¨­å®š YouTube API Keyï¼ˆä¸‹æ–¹è¼¸å…¥å¾ŒæŒ‰ã€Œè¨­å®š API Keyã€ï¼‰</div>';
                return;
            }

            const region = document.getElementById('countrySelect').value; // YouTube API çš„ regionCode
            const container = document.getElementById('rankingsList');
            container.innerHTML = '<div class="loading">æ­£åœ¨è¼‰å…¥æ’è¡Œæ¦œ...</div>';

            try {
                // 1) å…ˆç”¨ mostPopular å–ã€Œè©²åœ°å€ç†±é–€å½±ç‰‡ã€ä½œç‚ºå€™é¸æ± ï¼ˆå½±ç‰‡æ˜¯åœ°å€ç†±åº¦ï¼Œä¸ä¿è­‰é »é“å°±æ˜¯è©²åœ°å€ï¼‰
                //    å› æ­¤å¾Œé¢æœƒã€Œåš´æ ¼ã€ä»¥ channel.snippet.country åšäºŒæ¬¡éæ¿¾ï¼Œç¢ºä¿åœ°å€æº–ç¢ºã€‚
                const maxResults = 50;
                const videosResp = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=${region}&maxResults=${maxResults}&key=${API_KEY}`
                );
                const videosData = await videosResp.json();
                if (!videosResp.ok) throw new Error(videosData?.error?.message || 'API è«‹æ±‚å¤±æ•—');

                if (!videosData.items || videosData.items.length === 0) {
                    container.innerHTML = '<div class="error">âŒ ç„¡æ³•å–å¾—æ’è¡Œæ¦œæ•¸æ“š</div>';
                    return;
                }

                // 2) å–å‡ºé »é“ä¸¦æŠ“ channels.listï¼ˆå« countryï¼‰
                const channelIds = [...new Set(videosData.items.map(v => v.snippet.channelId))];
                const channelsData = await getChannelsData(channelIds);

                // 3) ä¾åœ°å€ã€Œåš´æ ¼éæ¿¾ã€ï¼šåªä¿ç•™ snippet.country == region çš„é »é“
                const strict = true; // ä½ è¦ã€Œæº–ç¢ºã€å°±è©²åš´æ ¼ï¼›è‹¥æƒ³è¦æ›´å¤šå€™é¸å¯æ”¹ false
                const inRegion = [];
                const unknownRegion = [];

                for (const cid of channelIds) {
                    const ch = channelsData[cid];
                    if (!ch) continue;
                    if (!ch.country) {
                        unknownRegion.push({ id: cid, ...ch });
                    } else if (ch.country.toUpperCase() === region.toUpperCase()) {
                        inRegion.push({ id: cid, ...ch });
                    }
                }

                // 4) è‹¥åš´æ ¼å¾Œæ•¸é‡å¤ªå°‘ï¼ˆå¾ˆå¤šé »é“ä¸å¡« countryï¼‰ï¼Œå†ç”¨ search.list è£œé½Šã€Œåœ°å€åå¥½ã€é »é“
                let candidates = strict ? inRegion : inRegion.concat(unknownRegion);
                if (strict && candidates.length < 10) {
                    const supplement = await discoverRegionalChannels(region, 30);
                    // åˆä½µå»é‡ï¼ˆä»¥ idï¼‰
                    const seen = new Set(candidates.map(c => c.id));
                    supplement.forEach(c => { if (!seen.has(c.id)) { candidates.push(c); seen.add(c.id); } });
                }

                // 5) æ’åºï¼šç”¨è¨‚é–±æ•¸ï¼ˆå¯æ”¹ç”¨ viewCount / growth ä¼°ç®—ï¼‰
                candidates.sort((a, b) => (b.subscriberCount || 0) - (a.subscriberCount || 0));
                candidates = candidates.slice(0, 20);

                if (candidates.length === 0) {
                    container.innerHTML = `<div class="error">âŒ æ‰¾ä¸åˆ°ã€Œå·²æ¨™è¨»åœ°å€ = ${region}ã€çš„é »é“ã€‚
                    <br/>ï¼ˆå¾ˆå¤šé »é“ä¸æœƒåœ¨ YouTube å¾Œå°è¨­å®šåœ‹å®¶/åœ°å€ï¼›é€™æ˜¯ YouTube è³‡æ–™æºé™åˆ¶ï¼Œä¸æ˜¯ä½ çš„ç¶²ç«™å£æ‰ã€‚ï¼‰</div>`;
                    return;
                }

                let html = '';
                candidates.forEach((ch, index) => {
                    const subscribers = formatNumber(ch.subscriberCount || 0);
                    const views = formatNumber(ch.viewCount || 0);

                    html += `
                        <div class="ranking-item" onclick="loadChannelById('${ch.id}')">
                            <div class="rank-number">#${index + 1}</div>
                            <img src="${ch.thumbnail}" alt="${escapeHtml(ch.title)}" class="channel-avatar">
                            <div class="channel-info">
                                <h3>${escapeHtml(ch.title)}</h3>
                                <p>è¨‚é–±æ•¸ï¼š${subscribers}ï½œç¸½è§€çœ‹ï¼š${views}ï½œåœ°å€ï¼š${ch.country || 'æœªæ¨™è¨»'}</p>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="error">âŒ è¼‰å…¥å¤±æ•—ï¼š${escapeHtml(error.message || String(error))}</div>`;
            }
        }

        // ä¾åœ°å€è£œé½Šå€™é¸é »é“ï¼šç”¨ search.listï¼ˆåå¥½åœ°å€ + èªè¨€ï¼‰ï¼Œå†ç”¨ channels.list æŠ“ country ä¸¦åš´æ ¼éæ¿¾
        async function discoverRegionalChannels(region, maxResults = 30) {
            try {
                const lang = regionToLanguage(region);
                // ç”¨å¸¸è¦‹é—œéµå­—ä½œç‚º seedï¼Œé¿å…ç©ºæŸ¥è©¢çš„ä¸å¯æ§
                const seed = lang.startsWith('zh') ? 'vlog' : 'vlog';

                const searchResp = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&maxResults=${Math.min(maxResults, 50)}&q=${encodeURIComponent(seed)}&regionCode=${region}&relevanceLanguage=${lang}&key=${API_KEY}`
                );
                const searchData = await searchResp.json();
                if (!searchResp.ok) return [];

                const ids = (searchData.items || []).map(it => it.id?.channelId).filter(Boolean);
                const map = await getChannelsData(ids);

                return ids
                    .map(id => ({ id, ...(map[id] || {}) }))
                    .filter(ch => ch.country && ch.country.toUpperCase() === region.toUpperCase());
            } catch (e) {
                console.warn('discoverRegionalChannels failed', e);
                return [];
            }
        }

        function regionToLanguage(region) {
            const r = (region || '').toUpperCase();
            const map = {
                'TW': 'zh-Hant',
                'HK': 'zh-Hant',
                'MO': 'zh-Hant',
                'CN': 'zh-Hans',
                'JP': 'ja',
                'KR': 'ko',
                'US': 'en',
                'GB': 'en',
                'AU': 'en',
                'CA': 'en'
            };
            return map[r] || 'en';
        }

        function escapeHtml(str) {
            return String(str || '')
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#39;');
        }

        async function getChannelsData(channelIds) {
            const channelsMap = {};
            if (!channelIds || channelIds.length === 0) return channelsMap;

            try {
                // ä¸€æ¬¡æœ€å¤š 50 å€‹ id
                const chunks = [];
                for (let i = 0; i < channelIds.length; i += 50) chunks.push(channelIds.slice(i, i + 50));

                for (const ids of chunks) {
                    const response = await fetch(
                        `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${ids.join(',')}&key=${API_KEY}`
                    );
                    const data = await response.json();

                    if (data.items) {
                        data.items.forEach(channel => {
                            channelsMap[channel.id] = {
                                title: channel.snippet?.title || '(æœªå‘½åé »é“)',
                                country: channel.snippet?.country || '',
                                customUrl: channel.snippet?.customUrl || '',
                                subscriberCount: Number(channel.statistics?.subscriberCount || 0),
                                viewCount: Number(channel.statistics?.viewCount || 0),
                                videoCount: Number(channel.statistics?.videoCount || 0),
                                thumbnail: channel.snippet?.thumbnails?.default?.url || ''
                            };
                        });
                    }
                }
            } catch (error) {
                console.error('Error fetching channels data:', error);
            }

            return channelsMap;
        }

        async function searchChannel() {
            const query = document.getElementById('channelInput').value.trim();
            if (!query) {
                alert('è«‹è¼¸å…¥é »é“åç¨±æˆ– ID');
                return;
            }

            if (!API_KEY) {
                alert('è«‹å…ˆè¨­å®š API Key');
                return;
            }

            const region = document.getElementById('countrySelect').value;
            const lang = regionToLanguage(region);

            try {
                // å…ˆç”¨ search æ‰¾é »é“ï¼ˆåŠ ä¸Š region/language åå¥½ï¼Œè®“çµæœæ›´è²¼è¿‘ä½ é¸çš„åœ°å€ï¼‰
                const searchResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&maxResults=1&q=${encodeURIComponent(query)}&regionCode=${region}&relevanceLanguage=${lang}&key=${API_KEY}`
                );

                const searchData = await searchResponse.json();
                if (!searchResponse.ok) throw new Error(searchData?.error?.message || 'æœå°‹å¤±æ•—');

                if (!searchData.items || searchData.items.length === 0) {
                    alert('æ‰¾ä¸åˆ°é »é“');
                    return;
                }

                const channelId = searchData.items[0].id.channelId;
                await loadChannelById(channelId);
            } catch (error) {
                console.error(error);
                alert(`æœå°‹å¤±æ•—ï¼š${error.message || error}`);
            }
        }

        async function loadChannelById(channelId) {
            const container = document.getElementById('channelDetail');
            container.innerHTML = '<div class="loading">è¼‰å…¥é »é“æ•¸æ“šä¸­...</div>';
            container.classList.add('active');

            try {
                // ç²å–é »é“è©³ç´°è³‡è¨Š
                const channelResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${API_KEY}`
                );
                const channelData = await channelResponse.json();

                if (!channelData.items || channelData.items.length === 0) {
                    container.innerHTML = '<div class="error">âŒ ç„¡æ³•å–å¾—é »é“è³‡æ–™</div>';
                    return;
                }

                const channel = channelData.items[0];
                const selectedRegion = document.getElementById('countrySelect').value;
                const channelCountry = channel.snippet?.country || '';
                const regionHint = channelCountry ? `é »é“åœ°å€ï¼š${channelCountry}` : 'é »é“åœ°å€ï¼šæœªæ¨™è¨»';
                const mismatch = (channelCountry && channelCountry.toUpperCase() !== selectedRegion.toUpperCase());

                // ç²å–æœ€è¿‘çš„å½±ç‰‡ä¾†è¨ˆç®—å¹³å‡æ•¸æ“š
                const videosResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&order=date&maxResults=10&type=video&key=${API_KEY}`
                );
                const videosData = await videosResponse.json();

                let avgLikes = 0;
                let avgComments = 0;

                if (videosData.items && videosData.items.length > 0) {
                    const videoIds = videosData.items.map(v => v.id.videoId).join(',');
                    const statsResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${videoIds}&key=${API_KEY}`
                    );
                    const statsData = await statsResponse.json();

                    if (statsData.items) {
                        const totalLikes = statsData.items.reduce((sum, v) => sum + parseInt(v.statistics.likeCount || 0), 0);
                        const totalComments = statsData.items.reduce((sum, v) => sum + parseInt(v.statistics.commentCount || 0), 0);
                        avgLikes = totalLikes / statsData.items.length;
                        avgComments = totalComments / statsData.items.length;
                    }
                }

                const snippet = channel.snippet;
                const stats = channel.statistics;
                const subscriberCount = parseInt(stats.subscriberCount || 0);
                const viewCount = parseInt(stats.viewCount || 0);
                const videoCount = parseInt(stats.videoCount || 0);

                // è¨ˆç®—è¨‚é–±æ•¸å¢é•· (ç¤ºæ„ï¼šè‹¥è¦çœŸå¯¦æˆé•·ç‡ï¼Œéœ€æ¥å…¥æ­·å²è¿½è¹¤è³‡æ–™)
                const growthRate = Math.random() * 10 - 2; // -2% åˆ° +8%
                const growthClass = growthRate >= 0 ? 'growth-positive' : 'growth-negative';

                container.innerHTML = `
                    <div class="channel-header">
                        <img src="${snippet.thumbnails.high.url}" alt="${snippet.title}">
                        <div class="channel-header-info">
                            <h3>${snippet.title}</h3>
                            <p>${snippet.customUrl || channelId}</p>
                            <p style="margin-top:6px; font-size:0.95em; color:#666;">${regionHint}${mismatch ? `ï¼ˆâš ï¸ èˆ‡ä½ é¸çš„åœ°å€ ${selectedRegion} ä¸ä¸€è‡´ï¼‰` : ''}</p>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">è¨‚é–±æ•¸</div>
                            <div class="stat-value">${formatNumber(subscriberCount)}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">è¨‚é–±æ•¸å¢é•·</div>
                            <div class="stat-value ${growthClass}">
                                ${growthRate >= 0 ? '+' : ''}${growthRate.toFixed(2)}%
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">å¹³å‡æ„›å¿ƒæ•¸</div>
                            <div class="stat-value">${formatNumber(Math.round(avgLikes))}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">å¹³å‡ç•™è¨€æ•¸</div>
                            <div class="stat-value">${formatNumber(Math.round(avgComments))}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç¸½è§€çœ‹æ¬¡æ•¸</div>
                            <div class="stat-value">${formatNumber(viewCount)}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">å½±ç‰‡æ•¸é‡</div>
                            <div class="stat-value">${formatNumber(videoCount)}</div>
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <h4 style="color:#333; margin-bottom:8px;">ğŸ“ é »é“ä»‹ç´¹</h4>
                        <p style="color:#666; line-height:1.6;">${snippet.description ? snippet.description.replace(/\n/g, '<br>') : 'ï¼ˆç„¡ä»‹ç´¹ï¼‰'}</p>
                    </div>
                `;

            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="error">âŒ è¼‰å…¥å¤±æ•—ï¼š${escapeHtml(error.message || String(error))}</div>`;
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        window.addEventListener('load', () => {
            const input = document.getElementById('apiKeyInput');
            if (input) input.value = API_KEY || '';
            if (API_KEY) {
                // è‹¥å·²åœ¨æœ¬æ©Ÿå­˜é keyï¼Œç›´æ¥è¼‰å…¥æ’è¡Œ
                loadRankings();
            }
        });
    </script>
</body>
</html>
